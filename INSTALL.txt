
INSTALLATION

clone repository content into sites/all/modules/custom/ folder

1) Get Color Picker Library
- 'drush make sites/all/modules/custom/iishagenda/iishagenda.make.example --no-core'
or install manually http://www.eyecon.ro/colorpicker/colorpicker.zip in libraries folder

2) Enable modules
- 'drush en iishagenda'
- 'y' (on downloading and enabling dependencies)
- 'drush cc all' (clearing cache)

3) template files
Copy to theme directory iisg/templates
- calendar-week-overlap.tpl.php
- node--event.tpl.php
- views-view-field--upcoming-events--page--name.tpl.php

4) template functions
Copy to iisg/template.php

// START TEMPLATE FUNCTIONS FOR IISH AGENDA
/*
 * Adds reservation number (node id) and cancelled value to template
 */
function iisg_preprocess_node(&$variables, $hook){
    if($variables["type"] == "event"){
        $variables["reservation_number"] =  t("Reserveringsnummer: ")."#".$variables["nid"];
        if(isset($variables['field_canceled'][LANGUAGE_NONE][0]) && $variables['field_canceled'][LANGUAGE_NONE][0]['value'] == 1)  $variables["canceled"] = t("Geannuleerd");
    }
}

/*
 * Makes changes to event views output
 */
function iisg_views_pre_render(&$view) {

    switch ($view->name) {
        case 'upcoming_events':

            foreach($view->result as $r => &$result) {
                _cancelcheck($result);
                if($result->field_field_special[0]['raw']['value'] == 1){
                    $result->field_field_special[0]['rendered']['#markup'] = "<img class='special' src='/".drupal_get_path('module','iishagenda')."/images/special.png' title='Dit is een speciaal evenement'>";
                }else{
                    $result->field_field_special[0]['rendered']['#markup'] = '';
                }
            }
            break;

        case 'calendar':
            foreach($view->result as $r => &$result) {
                if(isset($result->field_field_canceled)){
                    _cancelcheck($result);
                }
                $approved = issetor($result->field_field_approved[0]['raw']['value'],false);
                if($approved !== "1"){
                    $result->node_title = "- nog niet bevestigd -";
                }
            }
            break;

        case 'catering':
            foreach($view->result as $r => &$result) {
                if(isset($result->field_field_note[0]) && isset($result->field_field_event_room[0])){
                    $note = '<div class="messagepop pop">'.nl2br($result->field_field_note[0]["rendered"]["#markup"]).'</div>';
                    $markup = $result->field_field_event_room[0]["rendered"]["#markup"] ."<br>".$note.'<a href="#" class="messagepop-link">opmerking!</a>' ;
                    $result->field_field_event_room[0]["rendered"] = array('#markup'=>$markup,'#access'=>TRUE);
                }
            }
            break;
    }
}
/*
 * Add cancelled div for cancelled events
 */
function _cancelcheck(&$result){
    if(isset($result->field_field_canceled)){
        if( $result->field_field_canceled[0]['raw']['value'] == 1){
            $result->field_field_canceled[0]['rendered'] = "<span class='cancelled'>geannuleerd</span>";
        }else{
            $result->field_field_canceled[0]['rendered'] = "";
        }
    }
}
// END TEMPLATE FUNCTIONS FOR IISH AGENDA




5)
- 'drush cc all' clearing the cache


NOTE

- set jquery update to 1.7, jquery 1.10 throws errors in current version
- change "latest update" on home to relevant node types
- would be nice to have add event form into page instead of overlay now


SETUP

- Set up event administrator (email) : /admin/config/iishagenda
- define Date types and formats (type>format):  Week>W , event_date>d-m-Y H:i , Time>H:i, Month>F Y, Date>d-m-Y
- add link (path: /calendar) to main menu
- disable comments for Room and Event node types
- Define event types: admin/structure/taxonomy/event_type
    Conference
    Meeting
    Tour
    Workshop
    Other
- Set field permissions for fields in organiser fieldset, canceled and approval field (node type: event)
- set permissions so users can add events
    Event: Create new content
- disable comments for events ans rooms
- Add Rooms/locations: /node/add/room
- Add event: /node/add/event